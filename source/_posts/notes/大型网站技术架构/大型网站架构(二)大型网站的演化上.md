---
title: 大型网站技术架构(二)大型网站的演化上
copyright: true
date: 2020-04-27 11:29:26
tags: 
- 读书笔记
- 大型网站技术架构
categories: 
- 读书笔记
- 大型网站技术架构
keywords: 大型网站技术架构
password: 1234qwer
aside: Notes-LargeSite
---

前面我们提到和人类进化史一样，大型互联网站都不是一蹴而就的，没有天选之子从一诞生就拥有庞大的用户，高并发的访问，海量的数据。它们都是建立在业务不断发展的基础上，在不断遇到问题并解决问题的过程中，自然演化出来的。那么一个大型网站到底是如何从一个小鸡仔变成哥斯拉的呢？

#### 1.**初始阶段**

起初你们的网站只是一个小网站，根本没有几个用户，这个时候只需要一台服务器就绰绰有余，把应用程序，文件系统，数据库等所有的资源都在一台服务器上。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%841.png)

这个时候的网站其实是比较简单的。一般功能不太复杂，维护起来也很简单。只要你的团队不写出来太多的bug，一般是不会出现什么问题的。作为团队负责人的你喝喝茶、看看书的“闲暇之余”也能把工作干的很好。

#### 2.**应用服务和数据服务分离**

而随着网站业务的发展，你们的用户多了起来，访问量也变大了，慢慢你会发现一台服务器已经逐渐不能满足需求了：越来越多的用户访问导致性能越来越差，越来越多的数据导致存储空间不足。这个时候你就意识到必须做出改变了，如果不改变，那么你的老板就会把你炒掉，如果你的老板不把你炒掉，那么越来越糟糕的用户体验，频繁爆发的问题，就会让你们的客户把你们炒掉。

这时可以将应用和数据分离。应用和数据分离后，整个网站使用三台服务器：应用服务器、文件服务器和数据库服务器。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%842.png)

这么分绝不是瞎鸡儿分的，是有其道理的。应用程序更多的是逻辑计算，数据库需要快速磁盘检索和数据缓存，而文件系统则需要存储大量用户上传的文件。因此应用服务器需要更强大的CPU，数据服务器需要更大的硬盘和内存，而文件服务器需要更大的硬盘。

应用和数据分离后，不同的特性的服务器各司其职，网站的并发处理能力和数据存储空间得到很大的改善，幸运的你发现经过这么改造之后，网站的性能又好了起来，用户的投诉没有了，又可以以支持网站业务进一步的发展了。你成功的保住了自己的工作！

#### 3.**使用缓存改善网站性能**

随着你们业务的进一步发展，用户量也逐渐增多。你会发现dan teng的事又来了。数据库的压力太大导致访问延迟，进而影响整个网站的性能，用户体验受到影响。这时，如果你不想再次被老板叫去喝茶，就需要对网站进一步优化。

仔细分析你就会发现和现实世界的财富分配一样，网站数据的访问也遵循二八原则。80%的业务访问集中在20%的数据上。既然如此，就可以考虑将这20%的数据缓存下来，以避免更频繁的访问数据库，减少数据库的访问压力。

起初你也许会考虑将数据在本地缓存，本地缓存访问速度很快，但是受应用服务器内存的限制，其缓存数据量有限，而且还会出现和应用程序争内存的情况。这时候你可以部署大内存的服务器作为专门的缓存服务器。如果内存还不够你还可以使用集群的方式，这样理论上就可以做到不受内存容量的限制。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%843.png)

#### 4.**使用应用服务器集群改善网站的并发处理能力**

好了，使用缓存后，数据访问压力得到有效缓解。你再一次保住了自己的饭碗。不过慢慢你又发现由于单一应用服务器能够处理的请求连接有限，处理能力也有限，在网站访问高峰期，应用服务器成为整个网站的瓶颈。于是越来越多的用户会502，会请求超时，甚至应用服务器直接崩溃。

起初很多网站会采用更换性能更强大的服务器来解决问题，甚至不惜高价购买昂贵的小型机。但是慢慢会发现，不管多么强大的服务器，都满足不了网站持续增长的业务需求。

这种情况下，更恰当的做法是增加一台服务器以分担原有服务器的访问及存储压力。对网站架构而言，只要能通过增加一台服务器的方式改善负载压力，就可以以同样的方式持续增加服务器不断改善系统性能，从而实现系统的可伸缩性。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%844.png)

在使用应用服务器集群的同时，可以增加负载均衡调度服务器，可以将来自用户浏览器的访问请求分发到应用服务器集群中的任何一套服务器上，如果有更多的用户就在集群中加入更多的应用服务器，使应用服务器的负载压力不再成为整个网站的瓶颈。

#### 5.**数据库读写分离**

没错，当你看到标题的时候就知道，令人dan teng的问题就又双叒叕来了。网站在使用缓存后，使绝大部分数据读操作访问都可以不通过数据库就能完成，但是仍有一部分读操作(缓存访问不命中、缓存过期)和全部的写操作需要访问数据库，在网站的用户达到一定的规模后，数据库因为负载压力过高而有成了网站的瓶颈。

利用数据库主从热备的功能，配置两台数据库主从关系，可以将一台数据库服务器的数据更新同步到另一台服务器上。利用数据库的这一功能，可以实现数据库读写分离，从而改善数据库负载压力。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%845.png)

应用程序在写数据的时候，访问主数据库，主数据库通过主从复制将数据更新同步到从数据库，这样当应用服务器读数据的时候，就可以通过从数据库获得数据。为了便于应用程序访问读写分离后的数据库，通常在应用服务器使用专门的数据访问模块，使数据库读写分离对应用透明。

#### 小结

其实以上五个阶段已经可以适应市场上大多数网站了。它们的业务决定了他们大都停留在上面某个阶段。那么对于更大的一些互联网站呢，显然以上几个阶段和方案是远远不够，那么它们在演化的道路上又会遇到哪些问题，又是怎么解决的呢？我们下篇文章接着讲吧！

