---
title: 大型网站技术架构(三)大型网站的演化下
copyright: true
date: 2020-04-27 11:29:26
tags: 
- 读书笔记
- 大型网站技术架构
categories: 
- 读书笔记
- 大型网站技术架构
keywords: 大型网站技术架构
password: 1234qwer
aside: Notes-LargeSite
---

前面我们提到大型网站架构演化过程中的五个阶段。这篇文章我们接着来看在演化的过程中还会遇到什么问题，又是如何解决的？

#### 6.**使用反向代理和CDN加速网站响应**

随着你们网站业务的发展越来越快，用户的规模也越来越大，已经不仅仅局限于某一地区了。你们的用户可能已经遍及全国各个地区，甚至走向了世界。由于不同地区的复杂的网络环境，各个地方用户的访问速度差距也越来越大。这个时候你会发现有些像我一样的用户由于缺乏耐心。忍受不了较长的访问时间而离开，进而投入到你们竞争对手怀抱中。随着用户流失率的越来越高，看似镇定的你，内心其实慌得一批。为了提供更好的用户体验，留住用户，你必须要想办法加速网站访问速度。

这个时候，主要手段有使用CDN和反向代理。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%846.png)

CDN和反向代理的基本原理都是缓存，区别在于CDN部署在网络提供商的机房，使用户在请求网站服务时，可以从距离自己最近的网络提供商机房获取数据；而反向代理则部署在网站的中心机房，当用户请求到达中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户。

使用CDN和反向代理的目的都是尽早返回数据给用户，一方面加快用户访问速度，另一方面也减轻后端服务器的压力。

#### 7.**使用分布式文件系统和分布式数据库系统**

上一篇文章我们说到，任何强大的单一服务器都满足不了大型网站持续增长的业务需求。数据库和文件系统也是如此。即使数据库经过读写分离后，从一台服务器拆分成两台服务器，仍然不够。这时你应该考虑分库分表、分布式数据库和分布式文件系统。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%847.png)

注意：分布式数据库是网站数据库拆分的最后手段，只有在单表数据规模非常庞大的时候才使用。不到不得已时，网站更常用的数据库拆分手段是业务分库，将不同的业务的数据库部署在不同的物理服务器上。

#### 8.**使用NoSQL和搜索引擎**

随着网站业务越来越复杂，对数据存储和检索的需求也越来越复杂，网站需要采用一些非关系型数据库技术如NoSQL和非数据库查询技术如搜索引擎。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%848.png)

NoSQL和搜索引擎都是源自互联网的技术手段，对可伸缩的分布式特性具有更好的支持。应用服务器则通过一个统一数据访问模块访问各种数据，减轻应用程序管理诸多数据源的麻烦。

#### 9.**业务拆分**

相信你们的网站如果经过上面这些阶段的发展，你们的网站已然成为一个“庞然大物”。你们的业务范围会越来越广，业务场景也日益复杂。研发团队必然也越来越大。此时不得不使用分而治之的手段将整个网站业务分成不同的产品线，如大型购物交易网站就会将首页、商铺、订单、买家、卖家等拆分成不同的产品线，分归不同的业务团队负责。

具体到技术上，也会根据产品线划分，将一个网站拆分成许多不同的应用，每个应用独立部署维护。应用之间可以通过一个超链接建立关系(在首页上的导航链接每个都指向不同的应用地址)，也可以通过接口通讯或者消息队列进行数据分发，当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%849.png)

#### 10.**分布式服务**

随着业务拆分越来越小，存储系统越来越庞大，应用系统的整体复杂度呈指数级增加，部署维护越来越困难。由于所有应用要和所有数据库系统连接，在数万台服务器规模的网站中，这些连接的数目是服务器规模的平方，导致数据库连接资源不足，拒绝服务。

既然每一个应用系统都需要执行许多相同的业务操作，比如用户管理、商品管理等，那么可以将这些共用的业务提取出来，独立部署。由这些可复用的业务连接数据库，提供共用业务服务，而应用系统只需要管理用户界面，通过分布式服务调用业务服务完成具体操作。

![](https://hunter-image.oss-cn-beijing.aliyuncs.com/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/%E6%BC%94%E5%8C%96/%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%8410.png)

大型网站的架构演化到这里，基本上大多数的技术问题都得以解决，诸如数据中心的实时数据同步和具体网站业务相关的问题也都可以通过组合改进现有技术架构来解决。

但事物发展到一定阶段，作者认为，就会拥有其自发展性，向着更强大的方向发展。也会衍生出更多的业务，既然大型网站架构解决了海量数据的管理和高并发事务的处理，那么就可以把这些解决方案应用到网站自身以外的业务上去，可以出售问题的解决方案，也可以将计算作为一种基础资源出售，中小网站不需要再关心技术架构问题，只需要按需付费，就可以使网站随着业务的增长逐渐获得更大的存储空间和更多的计算资源。再者，网站的访问并非是均匀的，有其高峰期，也有低谷期。比如双十一的时候，假设淘宝需要使用10000台服务器，而平时可能只需要3000台就够了。那么平时的时候这7000台服务器怎么办呢？

这个时候就可以把他们租借出去。于是越来越多的大型网站都开始建设云计算平台，提供大型网站的解决方案，计算资源，服务器资源等。

#### 总结

大型网站架构技术的核心价值不是从无到有搭建一个大型网站，而是能够伴随小型网站业务的逐步发展，慢慢地演化成一个大型网站。所以网站还很小的时候就去追求网站的架构是舍本逐末，得不偿失的。小型网站最需要做的就是为用户提供好的服务来创造价值，得到用户的认可，活下去，野蛮生长。

看似漫长而惊心动魄的演化过程，实则是随着业务的发展而水到聚成的一件事。没有必要去刻意的追求大型网站的解决方案。由于大公司巨大成功的光环效应，再加上有些所谓“大公司技术高手”的影响，网站在讨论架构决策时，最有说服力的一句话就成了“淘宝就是这么搞的”或者“Facebook就是这么搞的”。

大公司的经验和成功模式固然重要，值得学习借鉴，但如果因此而变得盲从，就失去了坚持自我的勇气，在架构演化的道路上迟早会迷路。

网站技术是为了业务而存在的，除此毫无意义，在技术选型和架构设计中，脱离网站业务发展的实际，一味追求时髦的新技术，可能会将网站技术发展引入歧途。技术是用来解决业务问题的，而业务的问题，也可以通过业务的手段去解决。

我也曾经陷入过这样的误区，我的第一家公司是一家传统公司，想要转型互联网电商。而我们的团队也是一群热爱技术的人，于是我们借鉴了许多京东淘宝的解决方案。但是由于技术发展的脚步过快，技术团队也变得越来越大，远远超过了业务发展的脚步，最终也只能是失败收场了！



